package com.cleanroommc.kirino.engine.render.scene.gpu_meshlet;

import com.google.common.base.Preconditions;
import org.jspecify.annotations.NonNull;

import java.nio.ByteBuffer;

public class MeshletGpuWriter {
    private final MeshletGpuRegistry meshletGpuRegistry;

    public MeshletGpuWriter(MeshletGpuRegistry meshletGpuRegistry) {
        this.meshletGpuRegistry = meshletGpuRegistry;
    }

    /**
     * Use one view per thread.
     *
     * @return The view of a persistently mapped buffer
     */
    @NonNull
    public ByteBuffer getNewByteBufferView() {
        ByteBuffer byteBuffer = meshletGpuRegistry.meshletInputBuffer.getWriteTarget().getPersistentMappedBuffer();
        Preconditions.checkState(byteBuffer != null,
                "The persistently mapped buffer is null.");

        return byteBuffer.duplicate();
    }

    /**
     * Provide the correct byte buffer and all the info, and write to gpu.
     *
     * @param byteBuffer The byte buffer that comes from {@link #getNewByteBufferView()}
     */
    public void writeMeshlet(
            ByteBuffer byteBuffer,
            int meshletId,
            int chunkPosX,
            int chunkPosY,
            int chunkPosZ,
            float normalX,
            float normalY,
            float normalZ,
            int block0PositionAndFaceMask,
            int block0Xp0,
            int block0Xp1,
            int block0Xp2,
            int block0Xp3,
            int block0Xm0,
            int block0Xm1,
            int block0Xm2,
            int block0Xm3,
            int block0Yp0,
            int block0Yp1,
            int block0Yp2,
            int block0Yp3,
            int block0Ym0,
            int block0Ym1,
            int block0Ym2,
            int block0Ym3,
            int block0Zp0,
            int block0Zp1,
            int block0Zp2,
            int block0Zp3,
            int block0Zm0,
            int block0Zm1,
            int block0Zm2,
            int block0Zm3,
            int block1PositionAndFaceMask,
            int block1Xp0,
            int block1Xp1,
            int block1Xp2,
            int block1Xp3,
            int block1Xm0,
            int block1Xm1,
            int block1Xm2,
            int block1Xm3,
            int block1Yp0,
            int block1Yp1,
            int block1Yp2,
            int block1Yp3,
            int block1Ym0,
            int block1Ym1,
            int block1Ym2,
            int block1Ym3,
            int block1Zp0,
            int block1Zp1,
            int block1Zp2,
            int block1Zp3,
            int block1Zm0,
            int block1Zm1,
            int block1Zm2,
            int block1Zm3,
            int block2PositionAndFaceMask,
            int block2Xp0,
            int block2Xp1,
            int block2Xp2,
            int block2Xp3,
            int block2Xm0,
            int block2Xm1,
            int block2Xm2,
            int block2Xm3,
            int block2Yp0,
            int block2Yp1,
            int block2Yp2,
            int block2Yp3,
            int block2Ym0,
            int block2Ym1,
            int block2Ym2,
            int block2Ym3,
            int block2Zp0,
            int block2Zp1,
            int block2Zp2,
            int block2Zp3,
            int block2Zm0,
            int block2Zm1,
            int block2Zm2,
            int block2Zm3,
            int block3PositionAndFaceMask,
            int block3Xp0,
            int block3Xp1,
            int block3Xp2,
            int block3Xp3,
            int block3Xm0,
            int block3Xm1,
            int block3Xm2,
            int block3Xm3,
            int block3Yp0,
            int block3Yp1,
            int block3Yp2,
            int block3Yp3,
            int block3Ym0,
            int block3Ym1,
            int block3Ym2,
            int block3Ym3,
            int block3Zp0,
            int block3Zp1,
            int block3Zp2,
            int block3Zp3,
            int block3Zm0,
            int block3Zm1,
            int block3Zm2,
            int block3Zm3,
            int block4PositionAndFaceMask,
            int block4Xp0,
            int block4Xp1,
            int block4Xp2,
            int block4Xp3,
            int block4Xm0,
            int block4Xm1,
            int block4Xm2,
            int block4Xm3,
            int block4Yp0,
            int block4Yp1,
            int block4Yp2,
            int block4Yp3,
            int block4Ym0,
            int block4Ym1,
            int block4Ym2,
            int block4Ym3,
            int block4Zp0,
            int block4Zp1,
            int block4Zp2,
            int block4Zp3,
            int block4Zm0,
            int block4Zm1,
            int block4Zm2,
            int block4Zm3,
            int block5PositionAndFaceMask,
            int block5Xp0,
            int block5Xp1,
            int block5Xp2,
            int block5Xp3,
            int block5Xm0,
            int block5Xm1,
            int block5Xm2,
            int block5Xm3,
            int block5Yp0,
            int block5Yp1,
            int block5Yp2,
            int block5Yp3,
            int block5Ym0,
            int block5Ym1,
            int block5Ym2,
            int block5Ym3,
            int block5Zp0,
            int block5Zp1,
            int block5Zp2,
            int block5Zp3,
            int block5Zm0,
            int block5Zm1,
            int block5Zm2,
            int block5Zm3,
            int block6PositionAndFaceMask,
            int block6Xp0,
            int block6Xp1,
            int block6Xp2,
            int block6Xp3,
            int block6Xm0,
            int block6Xm1,
            int block6Xm2,
            int block6Xm3,
            int block6Yp0,
            int block6Yp1,
            int block6Yp2,
            int block6Yp3,
            int block6Ym0,
            int block6Ym1,
            int block6Ym2,
            int block6Ym3,
            int block6Zp0,
            int block6Zp1,
            int block6Zp2,
            int block6Zp3,
            int block6Zm0,
            int block6Zm1,
            int block6Zm2,
            int block6Zm3,
            int block7PositionAndFaceMask,
            int block7Xp0,
            int block7Xp1,
            int block7Xp2,
            int block7Xp3,
            int block7Xm0,
            int block7Xm1,
            int block7Xm2,
            int block7Xm3,
            int block7Yp0,
            int block7Yp1,
            int block7Yp2,
            int block7Yp3,
            int block7Ym0,
            int block7Ym1,
            int block7Ym2,
            int block7Ym3,
            int block7Zp0,
            int block7Zp1,
            int block7Zp2,
            int block7Zp3,
            int block7Zm0,
            int block7Zm1,
            int block7Zm2,
            int block7Zm3,
            int block8PositionAndFaceMask,
            int block8Xp0,
            int block8Xp1,
            int block8Xp2,
            int block8Xp3,
            int block8Xm0,
            int block8Xm1,
            int block8Xm2,
            int block8Xm3,
            int block8Yp0,
            int block8Yp1,
            int block8Yp2,
            int block8Yp3,
            int block8Ym0,
            int block8Ym1,
            int block8Ym2,
            int block8Ym3,
            int block8Zp0,
            int block8Zp1,
            int block8Zp2,
            int block8Zp3,
            int block8Zm0,
            int block8Zm1,
            int block8Zm2,
            int block8Zm3,
            int block9PositionAndFaceMask,
            int block9Xp0,
            int block9Xp1,
            int block9Xp2,
            int block9Xp3,
            int block9Xm0,
            int block9Xm1,
            int block9Xm2,
            int block9Xm3,
            int block9Yp0,
            int block9Yp1,
            int block9Yp2,
            int block9Yp3,
            int block9Ym0,
            int block9Ym1,
            int block9Ym2,
            int block9Ym3,
            int block9Zp0,
            int block9Zp1,
            int block9Zp2,
            int block9Zp3,
            int block9Zm0,
            int block9Zm1,
            int block9Zm2,
            int block9Zm3,
            int block10PositionAndFaceMask,
            int block10Xp0,
            int block10Xp1,
            int block10Xp2,
            int block10Xp3,
            int block10Xm0,
            int block10Xm1,
            int block10Xm2,
            int block10Xm3,
            int block10Yp0,
            int block10Yp1,
            int block10Yp2,
            int block10Yp3,
            int block10Ym0,
            int block10Ym1,
            int block10Ym2,
            int block10Ym3,
            int block10Zp0,
            int block10Zp1,
            int block10Zp2,
            int block10Zp3,
            int block10Zm0,
            int block10Zm1,
            int block10Zm2,
            int block10Zm3,
            int block11PositionAndFaceMask,
            int block11Xp0,
            int block11Xp1,
            int block11Xp2,
            int block11Xp3,
            int block11Xm0,
            int block11Xm1,
            int block11Xm2,
            int block11Xm3,
            int block11Yp0,
            int block11Yp1,
            int block11Yp2,
            int block11Yp3,
            int block11Ym0,
            int block11Ym1,
            int block11Ym2,
            int block11Ym3,
            int block11Zp0,
            int block11Zp1,
            int block11Zp2,
            int block11Zp3,
            int block11Zm0,
            int block11Zm1,
            int block11Zm2,
            int block11Zm3,
            int block12PositionAndFaceMask,
            int block12Xp0,
            int block12Xp1,
            int block12Xp2,
            int block12Xp3,
            int block12Xm0,
            int block12Xm1,
            int block12Xm2,
            int block12Xm3,
            int block12Yp0,
            int block12Yp1,
            int block12Yp2,
            int block12Yp3,
            int block12Ym0,
            int block12Ym1,
            int block12Ym2,
            int block12Ym3,
            int block12Zp0,
            int block12Zp1,
            int block12Zp2,
            int block12Zp3,
            int block12Zm0,
            int block12Zm1,
            int block12Zm2,
            int block12Zm3,
            int block13PositionAndFaceMask,
            int block13Xp0,
            int block13Xp1,
            int block13Xp2,
            int block13Xp3,
            int block13Xm0,
            int block13Xm1,
            int block13Xm2,
            int block13Xm3,
            int block13Yp0,
            int block13Yp1,
            int block13Yp2,
            int block13Yp3,
            int block13Ym0,
            int block13Ym1,
            int block13Ym2,
            int block13Ym3,
            int block13Zp0,
            int block13Zp1,
            int block13Zp2,
            int block13Zp3,
            int block13Zm0,
            int block13Zm1,
            int block13Zm2,
            int block13Zm3,
            int block14PositionAndFaceMask,
            int block14Xp0,
            int block14Xp1,
            int block14Xp2,
            int block14Xp3,
            int block14Xm0,
            int block14Xm1,
            int block14Xm2,
            int block14Xm3,
            int block14Yp0,
            int block14Yp1,
            int block14Yp2,
            int block14Yp3,
            int block14Ym0,
            int block14Ym1,
            int block14Ym2,
            int block14Ym3,
            int block14Zp0,
            int block14Zp1,
            int block14Zp2,
            int block14Zp3,
            int block14Zm0,
            int block14Zm1,
            int block14Zm2,
            int block14Zm3,
            int block15PositionAndFaceMask,
            int block15Xp0,
            int block15Xp1,
            int block15Xp2,
            int block15Xp3,
            int block15Xm0,
            int block15Xm1,
            int block15Xm2,
            int block15Xm3,
            int block15Yp0,
            int block15Yp1,
            int block15Yp2,
            int block15Yp3,
            int block15Ym0,
            int block15Ym1,
            int block15Ym2,
            int block15Ym3,
            int block15Zp0,
            int block15Zp1,
            int block15Zp2,
            int block15Zp3,
            int block15Zm0,
            int block15Zm1,
            int block15Zm2,
            int block15Zm3,
            int block16PositionAndFaceMask,
            int block16Xp0,
            int block16Xp1,
            int block16Xp2,
            int block16Xp3,
            int block16Xm0,
            int block16Xm1,
            int block16Xm2,
            int block16Xm3,
            int block16Yp0,
            int block16Yp1,
            int block16Yp2,
            int block16Yp3,
            int block16Ym0,
            int block16Ym1,
            int block16Ym2,
            int block16Ym3,
            int block16Zp0,
            int block16Zp1,
            int block16Zp2,
            int block16Zp3,
            int block16Zm0,
            int block16Zm1,
            int block16Zm2,
            int block16Zm3,
            int block17PositionAndFaceMask,
            int block17Xp0,
            int block17Xp1,
            int block17Xp2,
            int block17Xp3,
            int block17Xm0,
            int block17Xm1,
            int block17Xm2,
            int block17Xm3,
            int block17Yp0,
            int block17Yp1,
            int block17Yp2,
            int block17Yp3,
            int block17Ym0,
            int block17Ym1,
            int block17Ym2,
            int block17Ym3,
            int block17Zp0,
            int block17Zp1,
            int block17Zp2,
            int block17Zp3,
            int block17Zm0,
            int block17Zm1,
            int block17Zm2,
            int block17Zm3,
            int block18PositionAndFaceMask,
            int block18Xp0,
            int block18Xp1,
            int block18Xp2,
            int block18Xp3,
            int block18Xm0,
            int block18Xm1,
            int block18Xm2,
            int block18Xm3,
            int block18Yp0,
            int block18Yp1,
            int block18Yp2,
            int block18Yp3,
            int block18Ym0,
            int block18Ym1,
            int block18Ym2,
            int block18Ym3,
            int block18Zp0,
            int block18Zp1,
            int block18Zp2,
            int block18Zp3,
            int block18Zm0,
            int block18Zm1,
            int block18Zm2,
            int block18Zm3,
            int block19PositionAndFaceMask,
            int block19Xp0,
            int block19Xp1,
            int block19Xp2,
            int block19Xp3,
            int block19Xm0,
            int block19Xm1,
            int block19Xm2,
            int block19Xm3,
            int block19Yp0,
            int block19Yp1,
            int block19Yp2,
            int block19Yp3,
            int block19Ym0,
            int block19Ym1,
            int block19Ym2,
            int block19Ym3,
            int block19Zp0,
            int block19Zp1,
            int block19Zp2,
            int block19Zp3,
            int block19Zm0,
            int block19Zm1,
            int block19Zm2,
            int block19Zm3,
            int block20PositionAndFaceMask,
            int block20Xp0,
            int block20Xp1,
            int block20Xp2,
            int block20Xp3,
            int block20Xm0,
            int block20Xm1,
            int block20Xm2,
            int block20Xm3,
            int block20Yp0,
            int block20Yp1,
            int block20Yp2,
            int block20Yp3,
            int block20Ym0,
            int block20Ym1,
            int block20Ym2,
            int block20Ym3,
            int block20Zp0,
            int block20Zp1,
            int block20Zp2,
            int block20Zp3,
            int block20Zm0,
            int block20Zm1,
            int block20Zm2,
            int block20Zm3,
            int block21PositionAndFaceMask,
            int block21Xp0,
            int block21Xp1,
            int block21Xp2,
            int block21Xp3,
            int block21Xm0,
            int block21Xm1,
            int block21Xm2,
            int block21Xm3,
            int block21Yp0,
            int block21Yp1,
            int block21Yp2,
            int block21Yp3,
            int block21Ym0,
            int block21Ym1,
            int block21Ym2,
            int block21Ym3,
            int block21Zp0,
            int block21Zp1,
            int block21Zp2,
            int block21Zp3,
            int block21Zm0,
            int block21Zm1,
            int block21Zm2,
            int block21Zm3,
            int block22PositionAndFaceMask,
            int block22Xp0,
            int block22Xp1,
            int block22Xp2,
            int block22Xp3,
            int block22Xm0,
            int block22Xm1,
            int block22Xm2,
            int block22Xm3,
            int block22Yp0,
            int block22Yp1,
            int block22Yp2,
            int block22Yp3,
            int block22Ym0,
            int block22Ym1,
            int block22Ym2,
            int block22Ym3,
            int block22Zp0,
            int block22Zp1,
            int block22Zp2,
            int block22Zp3,
            int block22Zm0,
            int block22Zm1,
            int block22Zm2,
            int block22Zm3,
            int block23PositionAndFaceMask,
            int block23Xp0,
            int block23Xp1,
            int block23Xp2,
            int block23Xp3,
            int block23Xm0,
            int block23Xm1,
            int block23Xm2,
            int block23Xm3,
            int block23Yp0,
            int block23Yp1,
            int block23Yp2,
            int block23Yp3,
            int block23Ym0,
            int block23Ym1,
            int block23Ym2,
            int block23Ym3,
            int block23Zp0,
            int block23Zp1,
            int block23Zp2,
            int block23Zp3,
            int block23Zm0,
            int block23Zm1,
            int block23Zm2,
            int block23Zm3,
            int block24PositionAndFaceMask,
            int block24Xp0,
            int block24Xp1,
            int block24Xp2,
            int block24Xp3,
            int block24Xm0,
            int block24Xm1,
            int block24Xm2,
            int block24Xm3,
            int block24Yp0,
            int block24Yp1,
            int block24Yp2,
            int block24Yp3,
            int block24Ym0,
            int block24Ym1,
            int block24Ym2,
            int block24Ym3,
            int block24Zp0,
            int block24Zp1,
            int block24Zp2,
            int block24Zp3,
            int block24Zm0,
            int block24Zm1,
            int block24Zm2,
            int block24Zm3,
            int block25PositionAndFaceMask,
            int block25Xp0,
            int block25Xp1,
            int block25Xp2,
            int block25Xp3,
            int block25Xm0,
            int block25Xm1,
            int block25Xm2,
            int block25Xm3,
            int block25Yp0,
            int block25Yp1,
            int block25Yp2,
            int block25Yp3,
            int block25Ym0,
            int block25Ym1,
            int block25Ym2,
            int block25Ym3,
            int block25Zp0,
            int block25Zp1,
            int block25Zp2,
            int block25Zp3,
            int block25Zm0,
            int block25Zm1,
            int block25Zm2,
            int block25Zm3,
            int block26PositionAndFaceMask,
            int block26Xp0,
            int block26Xp1,
            int block26Xp2,
            int block26Xp3,
            int block26Xm0,
            int block26Xm1,
            int block26Xm2,
            int block26Xm3,
            int block26Yp0,
            int block26Yp1,
            int block26Yp2,
            int block26Yp3,
            int block26Ym0,
            int block26Ym1,
            int block26Ym2,
            int block26Ym3,
            int block26Zp0,
            int block26Zp1,
            int block26Zp2,
            int block26Zp3,
            int block26Zm0,
            int block26Zm1,
            int block26Zm2,
            int block26Zm3,
            int block27PositionAndFaceMask,
            int block27Xp0,
            int block27Xp1,
            int block27Xp2,
            int block27Xp3,
            int block27Xm0,
            int block27Xm1,
            int block27Xm2,
            int block27Xm3,
            int block27Yp0,
            int block27Yp1,
            int block27Yp2,
            int block27Yp3,
            int block27Ym0,
            int block27Ym1,
            int block27Ym2,
            int block27Ym3,
            int block27Zp0,
            int block27Zp1,
            int block27Zp2,
            int block27Zp3,
            int block27Zm0,
            int block27Zm1,
            int block27Zm2,
            int block27Zm3,
            int block28PositionAndFaceMask,
            int block28Xp0,
            int block28Xp1,
            int block28Xp2,
            int block28Xp3,
            int block28Xm0,
            int block28Xm1,
            int block28Xm2,
            int block28Xm3,
            int block28Yp0,
            int block28Yp1,
            int block28Yp2,
            int block28Yp3,
            int block28Ym0,
            int block28Ym1,
            int block28Ym2,
            int block28Ym3,
            int block28Zp0,
            int block28Zp1,
            int block28Zp2,
            int block28Zp3,
            int block28Zm0,
            int block28Zm1,
            int block28Zm2,
            int block28Zm3,
            int block29PositionAndFaceMask,
            int block29Xp0,
            int block29Xp1,
            int block29Xp2,
            int block29Xp3,
            int block29Xm0,
            int block29Xm1,
            int block29Xm2,
            int block29Xm3,
            int block29Yp0,
            int block29Yp1,
            int block29Yp2,
            int block29Yp3,
            int block29Ym0,
            int block29Ym1,
            int block29Ym2,
            int block29Ym3,
            int block29Zp0,
            int block29Zp1,
            int block29Zp2,
            int block29Zp3,
            int block29Zm0,
            int block29Zm1,
            int block29Zm2,
            int block29Zm3,
            int block30PositionAndFaceMask,
            int block30Xp0,
            int block30Xp1,
            int block30Xp2,
            int block30Xp3,
            int block30Xm0,
            int block30Xm1,
            int block30Xm2,
            int block30Xm3,
            int block30Yp0,
            int block30Yp1,
            int block30Yp2,
            int block30Yp3,
            int block30Ym0,
            int block30Ym1,
            int block30Ym2,
            int block30Ym3,
            int block30Zp0,
            int block30Zp1,
            int block30Zp2,
            int block30Zp3,
            int block30Zm0,
            int block30Zm1,
            int block30Zm2,
            int block30Zm3,
            int block31PositionAndFaceMask,
            int block31Xp0,
            int block31Xp1,
            int block31Xp2,
            int block31Xp3,
            int block31Xm0,
            int block31Xm1,
            int block31Xm2,
            int block31Xm3,
            int block31Yp0,
            int block31Yp1,
            int block31Yp2,
            int block31Yp3,
            int block31Ym0,
            int block31Ym1,
            int block31Ym2,
            int block31Ym3,
            int block31Zp0,
            int block31Zp1,
            int block31Zp2,
            int block31Zp3,
            int block31Zm0,
            int block31Zm1,
            int block31Zm2,
            int block31Zm3
    ) {
        int pos = meshletGpuRegistry.meshletBufferSlotAllocator.getSlotForMeshletId(meshletId) * MeshletInputDoubleBuffer.MESHLET_STRIDE_BYTE;
        byteBuffer.position(pos);


    }
}
